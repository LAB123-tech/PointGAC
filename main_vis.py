import torch

from tools.runner_test import test_net
from utils import parser, main_util
from utils.config import *
from utils.logger import *


def main():
    # ------------------------------------------------------------------------------------------------------------------
    # Set arguments and CUDA device
    # ------------------------------------------------------------------------------------------------------------------
    args = parser.get_args()
    device = torch.device('cuda:{}'.format(args.device) if torch.cuda.is_available() else 'cpu')
    # ------------------------------------------------------------------------------------------------------------------
    # Setup logger
    # ------------------------------------------------------------------------------------------------------------------
    logger = create_logger(args.log_path, args.exp_name)
    # ------------------------------------------------------------------------------------------------------------------
    # Load config file
    # ------------------------------------------------------------------------------------------------------------------
    config = cfg_from_yaml_file(args.config)
    # ------------------------------------------------------------------------------------------------------------------
    # Set random seed
    # ------------------------------------------------------------------------------------------------------------------
    if args.seed is not None:
        log_string(logger, f'[Random] Set random seed to {args.seed}')
        main_util.set_random_seed(args.seed)
    # ------------------------------------------------------------------------------------------------------------------
    # Evaluation
    # ------------------------------------------------------------------------------------------------------------------
    test_net(args, config, device, logger)


if __name__ == '__main__':
    main()
